!function(a){var t=!1,i=!1,e=a("#about_new_plat_layer").fadeOut(0),n=a("#migrate_overlay_shadow").fadeOut(0),r=e.find(".overlay_close"),s=e.find(".plat_layer_content > img"),o=a("#J-user-name"),c=a("#J-user-password"),l=a("#J-loginParam"),d=phoenix.Mask.getInstance(),u=a("#J-form-submit");d.css({opacity:0}),e.find(".plat_layer_tabs a").on("click",function(){a(this).parent().find("a").removeClass("active"),a(this).addClass("active"),s.fadeOut().eq(Number(a(this).text())-1).fadeIn()}),a("input:password").bind("copy cut paste",function(a){return!1});var h=function(){var a=location.search,t="redirect=",i="";if(-1!=a.indexOf(t))var i=a.substr(a.indexOf(t)+t.length);return i},f=function(){var a=["加载中   ","加载中.  ","加载中.. ","加载中..."],t=0;i=!0,d.show(u),clearInterval(f.timer),f.timer=setInterval(function(){u.val(a[t]),t=t>=a.length-1?0:t+1},200)},g=function(){var a="登 录";clearInterval(f.timer),i=!1,u.val(a),d.hide()},m=function(){return"none"!=a("#J-panel-vcode").css("display")?!0:!1},p=function(){var t=a("#J-vcode-img"),i=t.attr("data-src-path");t.attr("src",i+"?"+Math.random())},v=function(){var t=a("#J-verification"),i=a.trim(t.val()),e=!1;return m()?(""==i?(e=!1,showMsg("验证码不能为空")):/[A-Za-z0-9]{4}/.test(i)?e=!0:(e=!1,showMsg("验证码格式不正确")),e?hideMsgDom():t.focus(),e):!0};showDialog=function(){e.is(":hidden")&&n.is(":hidden")&&(e.show(),n.show())},hideDialog=function(){e.is(":hidden")||n.is(":hidden")||(e.hide(),n.hide())},a("#J-question-button").click(function(a){showDialog()}),a(document).click(function(t){var i=a(t.target);i.is(e)||e.has(i).size()>0||i.is(a("#J-question-button"))||hideDialog()}),r.click(function(a){hideDialog()}),checkInfo=function(t){var i=a(t),e=a(t).attr("data-name"),n=a(".clear-"+e),r=a.trim(i.val());r?n.show():n.hide()},a(".clear-password, .clear-name").click(function(t){var i=a(this).attr("data-name");a("#J-user-"+i).val(""),a(this).hide(),"password"==i&&a(".forget-password").css("right",10)}),o.bind("input propertychange",function(){checkInfo(this)}),c.bind("input propertychange",function(){checkInfo(this)}),c.focus(function(t){a(".forget-password").css("right",-200)}).blur(function(){c.val()||a(".forget-password").css("right",10)}),showMsg=function(t){var i=a("#J-msg-show"),e='<span class="warning"></span> ';openMsgDom(),i.html(e+t)},hideMsgDom=function(){var t=a("#J-msg-show");t.css("height",0).attr("data-display","hide").html("")},openMsgDom=function(){var t=a("#J-msg-show"),i=t.attr("data-display");"hide"==i&&t.css("height",20).attr("data-display","show")};var w=function(a,t,i,e){return t.link=b(t.id,t.link),t.src=t.src,t.width=i,t.height=e,t},b=function(a,t){return t};a.ajax({url:"/api/jsonp/getAdverts?u=-1&k=index_pos_login&r="+Math.random(),cache:!1,dataType:"jsonp",jsonp:"callBack",success:function(t){if(1==Number(t.isSuccess)){var i,e,n,r,s,o=t,c=o.data,l=c.length,d="";if(l>0)for(var u=0;l>u;u++)if("index_pos_login"==c[u].name&&(d="",n=500,r=288,e=a("#focus"),s='<div class="item"><a target="_blank" href="<#=link#>"><img src="<#=src#>" title="<#=title#>" alt="<#=title#>"></a></div>',e.size()>0))if(i=c[u].list.length,i>0){e.css({width:n});for(var h=0;i>h;h++)ad=w(s,c[u].list[h],n,r),ad.index=h+1,d=phoenix.util.template(s,ad),e.cycle("add",d)}else e.cycle("add",'<div class="item"><a target="_blank" href="/index"><img src="'+global_path_url+'/images/login/new-login/banner.jpg" alt=""></a></div>')}else a("#focus").cycle("add",'<div class="item"><a target="_blank" href="/index"><img src="'+global_path_url+'/images/login/new-login/banner.jpg" alt=""></a></div>')},error:function(t,i){a("#focus").cycle("add",'<div class="item"><a target="_blank" href="/index"><img src="'+global_path_url+'/images/login/new-login/banner.jpg" alt=""></a></div>')}}),u.bind("click",function(e){var n=a.trim(o.val()),r=a.trim(c.val()),s=a.trim(l.val()),d=a("#J-verification");if(""==n)return showMsg("用户名不能为空"),!1;if(n.length<2||n.length>16)return showMsg("用户名长度有误，请输入2-16位字符"),!1;if(""==r)return showMsg("密码不能为空"),!1;if(m()&&""==a.trim(d.val()))return showMsg("验证码不能为空"),!1;if(!t){t=!0,hideMsgDom();var u,w,b,_=a.trim(n),y=a.trim(r),k=a.trim(s);if(y=a.md5(a.md5(a.md5(a.md5(a.md5(y))))+k),m()){if(!v())return;u=a.trim(d.val()).toUpperCase(),b={username:_,password:y,param:k,vcode:u}}else b={username:_,password:y,param:k};a.ajax({url:"/login/login",type:"POST",dataType:"json",cache:!1,data:b,beforeSend:function(){w=setTimeout(f,500),i=!0}}).done(function(t){var i="/index";t.errors.length>0?(showMsg(t.errors[0][1]),(m()||t.data&&t.data>2)&&(a("#J-panel-vcode").show(),d.val(""),p()),"password"==t.errors[0][0]&&c.focus(),"username"==t.errors[0][0]&&o.focus(),l.val(t.param)):(i=""==h()?i:h(),location.href=i)}).fail(function(){}).always(function(){t=!1,clearTimeout(w),i=!1,g()}),e.preventDefault()}})}(jQuery);