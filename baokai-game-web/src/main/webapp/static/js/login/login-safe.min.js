!function(a){var e=a("#J-user-name"),i=a("#about_new_plat_layer").fadeOut(0),s=a("#migrate_overlay_shadow").fadeOut(0),t=i.find(".overlay_close"),n=i.find(".plat_layer_content > img"),r=a("#J-user-password"),o=a("#J-loginParam"),l=(a("#J-user-info"),a("#J-form-submit")),c=!1,d="/login/login",h="safe-step-1";i.find(".plat_layer_tabs a").on("click",function(){a(this).parent().find("a").removeClass("active"),a(this).addClass("active"),n.fadeOut().eq(Number(a(this).text())-1).fadeIn()}),showDialog=function(){i.is(":hidden")&&s.is(":hidden")&&(i.show(),s.show())},hideDialog=function(){i.is(":hidden")||s.is(":hidden")||(i.hide(),s.hide())};var f=function(){return a("#J-user-var").length>0?!0:!1},u=function(){var e=a("#J-vcode-img"),i=e.attr("data-src-path");e.attr("src",i+"?"+Math.random())},g=function(){var a=location.search,e="redirect=",i="";if(-1!=a.indexOf(e))var i=a.substr(a.indexOf(e)+e.length);return i};a("#J-question-button").click(function(a){showDialog()}),a(document).click(function(e){var s=a(e.target);s.is(i)||i.has(s).size()>0||s.is(a("#J-question-button"))||hideDialog()}),t.click(function(a){hideDialog()}),checkInfo=function(e){var i=a(e),s=a(e).attr("data-name"),t=a(".clear-"+s),n=a.trim(i.val());n?t.show():t.hide()},a(".clear-password, .clear-name").click(function(e){var i=a(this).attr("data-name");a("#J-user-"+i).val(""),a(this).hide(),"password"==i&&a(".forget-password").css("right",10)}),e.bind("input propertychange",function(){checkInfo(this)}),r.bind("input propertychange",function(){checkInfo(this)}),r.focus(function(e){a(".forget-password").css("right",-200)}).blur(function(){r.val()||a(".forget-password").css("right",10)}),showMsg=function(e){var i=a("#J-msg-show"),s='<span class="warning"></span> ';openMsgDom(),i.html(s+e)},hideMsgDom=function(){var e=a("#J-msg-show");e.css("height",0).attr("data-display","hide").html("")},openMsgDom=function(){var e=a("#J-msg-show"),i=e.attr("data-display");"hide"==i&&e.css("height",20).attr("data-display","show")};var p=function(a,e,i,s){return e.link=m(e.id,e.link),e.src=e.src,e.width=i,e.height=s,e},m=function(a,e){return e};a.ajax({url:"/api/jsonp/getAdverts?u=-1&k=index_pos_login&r="+Math.random(),cache:!1,dataType:"jsonp",jsonp:"callBack",success:function(e){if(1==Number(e.isSuccess)){var i,s,t,n,r,o=e,l=o.data,c=l.length,d="";if(c>0)for(var h=0;c>h;h++)if("index_pos_login"==l[h].name&&(d="",t=500,n=288,s=a("#focus"),r='<div class="item"><a target="_blank" href="<#=link#>"><img src="<#=src#>" title="<#=title#>" alt="<#=title#>"></a></div>',s.size()>0))if(i=l[h].list.length,i>0){s.css({width:t});for(var f=0;i>f;f++)ad=p(r,l[h].list[f],t,n),ad.index=f+1,d=phoenix.util.template(r,ad),s.cycle("add",d)}else s.cycle("add",'<div class="item"><a target="_blank" href="/index"><img src="'+global_path_url+'/images/login/new-login/banner.jpg" alt=""></a></div>')}else a("#focus").cycle("add",'<div class="item"><a target="_blank" href="/index"><img src="'+global_path_url+'/images/login/new-login/banner.jpg" alt=""></a></div>')},error:function(e,i){a("#focus").cycle("add",'<div class="item"><a target="_blank" href="/index"><img src="'+global_path_url+'/images/login/new-login/banner.jpg" alt=""></a></div>')}}),l.bind("click",function(i){var s=a.trim(e.val()),t=a.trim(r.val()),n=a.trim(o.val()),l=a("#J-verification");if("safe-step-1"==h&&e.size()>0&&""==s)return showMsg("用户名不能为空"),!1;if("safe-step-1"==h&&e.size()>0&&(s.length<2||s.length>16))return showMsg("用户名长度有误，请输入2-16位字符"),!1;if("safe-step-2"==h&&r.size()>0&&""==t)return showMsg("密码不能为空"),!1;if(l.size()>0&&""==a.trim(l.val()))return showMsg("验证码不能为空"),!1;if(!c){c=!0,hideMsgDom();var p={};f()?p={username:s,vcode:l.val(),safemod:1}:(t=a.md5(a.md5(a.md5(a.md5(a.md5(t))))+n),p={password:t,param:n}),a.ajax({url:d,type:"POST",dataType:"json",cache:!1,data:p}).done(function(i){if(i.errors.length>0)if(o.val(i.param),f())showMsg(i.errors[0][1]),i.data&&i.data>2&&(a("#J-panel-vcode").show(),l.val(""),u()),"password"==i.errors[0][0]&&r.focus(),"username"==i.errors[0][0]&&e.focus();else{showMsg(i.errors[0][1]);var s="/login/showsectlogin/";s=""==g()?s:g(),location.href=s}else if(f()){var t=null!=i.data.cipher?'您设置的预留信息为：<span class="safe-code">'+i.data.cipher+"</span>":"您尚未设置预留验证信息，请登录成功后前往安全中心设置!",n=null!=i.data.cipher?"<p>若“预留验证信息”与您设置不一致！请勿输入密码！</p>":"",c='<div class="user-code"><p>'+t+"</p>"+n+"</div>";h="safe-step-2",d="/login/sectlogin",a("#J-password-area").show(),a("#J-login-area").prepend(c),a("#J-username-area").addClass("hide"),a("#J-user-var").remove(),a("#J-form-submit").val("登 录")}else{var s="/index";s=""==g()?s:g(),location.href=s}}).fail(function(){}).always(function(){d=f()?"/login/login":"/login/sectlogin",c=!1}),i.preventDefault()}})}(jQuery);