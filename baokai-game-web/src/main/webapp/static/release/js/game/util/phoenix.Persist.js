!function(a,b){phoenix.Persist=function(){var c=this,d=/\s+/,e=/\s/g,f=/^.*\s/,g=/\s.*$/,h=/^.*:|\s/g,i=/:.*$/,j=(Persist.model=function(){var f={},g=function(b,g,i,j,k){var l,m,n=f,o=b.replace(e,""),b=a.trim(b);if(b||"string"==typeof b){if(g&&j)return void c.m.set("bindMethod "+b.replace(/\s/g,""),g);m=function(){if(d.test(b)){l=b.split(d);for(var c,e=0,j=l.length;j>e;e++)c=l[e],"undefined"==typeof n[c]&&(n[c]={}),e==j-1&&"undefined"!=typeof g&&("inset"==i&&!a.isEmptyObject(n[c])||"inset"==i&&"function"==typeof n[c]?(n[c].constructor!=Array&&(n[c]=[n[c]]),n[c].push(g)):n[c]=g),n=n[c]}else"undefined"!=typeof g?h(b,g,i):f[b]={};k&&k()},g&&"undefined"!=typeof c.m.get("bindMethod "+o+"change")?c.c.triggerEvent(o+"change",[c.m.get(b),g],m):m()}},h=function(b,c,d){"inset"!=d||a.isEmptyObject(f[b])?f[b]=c:(f[b].constructor!=Array&&(f[b]=[f[b]]),f[b].push(c))},i=function(a,b){for(var c,e=a.split(d),g=f,h=0,i=e.length;i>h;h++){if(c=e[h],"undefined"==typeof g[c])return;g=g[c]}return b&&b(),g},j=function(a,c){for(var e,g=a.split(d),h=f,i=0,j=g.length;j>i;i++){if(e=g[i],"undefined"==typeof h[e])return void k.tip("删除对象不存在请检查"+a);if(i==j-1)try{delete h[e]}catch(l){h[e]=b}h=h[e]}c&&c()};return{add:function(a,b){g(a,b)},set:function(a,b,c,d,e){g(a,b,c,d,e)},get:function(a){return a?d.test(a)?i(a):f[a]:f},destroy:function(a){a&&(d.test(a)?j(a):delete f[a])},remove:function(a,b){g(a,{},b)}}},Persist.controller={LS:storage,routeChange:function(b,d){var e=window.location;if(!a.isEmptyObject(b)){for(var f in b)k.isRegExp(f)||f.test(e)&&c.route[b[f]]();d&&d()}},pluginLoad:function(b,c){if("undefined"!=typeof a.use&&!a.isEmptyObject(b)){for(var d in b)a.use(b[d]);c&&c()}},bindEvent:function(a,b){var d=a&&-1!=a.indexOf("change")?a.replace(h,""):"",e=a.replace(i," ");return a&&b&&"string"==typeof d&&"function"==typeof b?void c.m.set(e+d,b,"inset",!0):(k.tip("请检查参数或检查事件名称写法:change:"+a),!1)},unbindEvent:function(a,b){var d=a&&-1!=a.indexOf("change")?a.replace(h,""):"",e=a.replace(i,"");return a?"all"==a?void c.m.remove(e):"undefined"==typeof c.m.get("bindMethod "+e+d)?void k.tip("当前数据模型没有绑定事件"+a):void c.m.destroy("bindMethod "+e+d,b):void k.tip("请输入绑定事件名称"+a)},triggerEvent:function(a,b,d){a&&-1!=a.indexOf("change")?a.replace(h,""):"",a.replace(i," ");return a?void k.executeEvents(c.m.get("bindMethod "+a),b,d):void k.tip("请填写事件名称"+a)}},Persist.view={events:{},render:function(a,b){return Mustache.render(a,b)},loadViewEvent:function(b){a.extend(!0,this,b),k._bindEvents(b)}}),k=(Persist.route={routes:{}},Persist.plugin={HTMLEngine:"mustache"},Persist.methodGather={_extractParameters:function(a,b){return a.exec(b).slice(1)},isRegExp:function(a){return"[object RegExp]"==toString.call(a)},bulidModel:function(){this.ejectionMethod(),this.bulidData()},executeSetting:function(){c.c.pluginLoad(c.plugin,c.c.routeChange(c.route.routes))},bulidData:function(){c.m.add("bindMethod"),c.m.add("route")},recursion:function(a,b){if(a.hasOwnProperty(b))return a[b];for(var c in a)return this.recursion(a[c],b)},tip:function(a){console&&"function"==typeof console.log&&console.log(a)},executeEvents:function(a,b,c){var d={current:b[0],change:b[1]};if("object"!=typeof a||a.constructor!=Array){if(a.call(d)===!1)return;return c()}for(var e=0,f=a.length;f>e;e++){if(a.call(d)===!1)return;c()}},_bindEvents:function(b){var c,d;for(var e in b.events)c=e.replace(f,""),d=e.replace(g,""),a("body").delegate(c,d,function(){j[b.events[e]]()})},ejectionMethod:function(){c.m=Persist.model(),c.c=Persist.controller,c.v=Persist.view,c.route=Persist.route,c.plugin=Persist.plugin}});k.bulidModel(),this.init()},phoenix.Persist.prototype={init:function(){Persist.methodGather.executeSetting()}}}(jQuery,void 0);